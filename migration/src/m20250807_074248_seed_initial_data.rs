use sea_orm_migration::prelude::*;

use crate::m20250807_073903_create_users_table::Users;
use crate::m20250807_073910_create_devices_table::Devices;
use crate::m20250807_073919_create_user_auth_table::UserAuth;

#[derive(DeriveMigrationName)]
pub struct Migration;

#[async_trait::async_trait]
impl MigrationTrait for Migration {
    async fn up(&self, manager: &SchemaManager) -> Result<(), DbErr> {
        let db = manager.get_connection();

        // Insert all 21 users (user01-user20 + apitest01)
        let users_data = vec![
            (
                "00000000-0000-0000-0000-000000000001",
                "user01",
                "user01@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000002",
                "user02",
                "user02@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000003",
                "user03",
                "user03@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000004",
                "user04",
                "user04@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000005",
                "user05",
                "user05@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000006",
                "user06",
                "user06@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000007",
                "user07",
                "user07@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000008",
                "user08",
                "user08@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000009",
                "user09",
                "user09@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000010",
                "user10",
                "user10@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000011",
                "user11",
                "user11@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000012",
                "user12",
                "user12@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000013",
                "user13",
                "user13@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000014",
                "user14",
                "user14@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000015",
                "user15",
                "user15@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000016",
                "user16",
                "user16@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000017",
                "user17",
                "user17@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000018",
                "user18",
                "user18@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000019",
                "user19",
                "user19@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000020",
                "user20",
                "user20@example.com",
            ),
            (
                "00000000-0000-0000-0000-000000000021",
                "apitest01",
                "apitest01@example.com",
            ),
        ];

        for (id, username, email) in users_data {
            let insert = Query::insert()
                .into_table(Users::Table)
                .columns([
                    Users::Id,
                    Users::Username,
                    Users::Email,
                    Users::CreatedAt,
                    Users::ModifiedAt,
                ])
                .values_panic([
                    id.into(),
                    username.into(),
                    email.into(),
                    Expr::current_timestamp().into(),
                    Expr::current_timestamp().into(),
                ])
                .to_owned();

            db.execute(db.get_database_backend().build(&insert)).await?;
        }

        // Insert all device data (4 devices per user for user01-user20)
        let devices_data = self.get_all_devices_data();

        for (id, user_id, name, status, device_os) in devices_data {
            let insert = Query::insert()
                .into_table(Devices::Table)
                .columns([
                    Devices::Id,
                    Devices::UserId,
                    Devices::Name,
                    Devices::Status,
                    Devices::DeviceOs,
                    Devices::RegisteredAt,
                    Devices::CreatedAt,
                    Devices::ModifiedAt,
                ])
                .values_panic([
                    id.into(),
                    user_id.into(),
                    name.into(),
                    status.into(),
                    device_os.into(),
                    Expr::current_timestamp().into(),
                    Expr::current_timestamp().into(),
                    Expr::current_timestamp().into(),
                ])
                .to_owned();

            db.execute(db.get_database_backend().build(&insert)).await?;
        }

        // Insert user_auth data - only for apitest01 with the specific password hash
        // password: test_password
        let insert = Query::insert()
            .into_table(UserAuth::Table)
            .columns([UserAuth::UserId, UserAuth::PasswordHash, UserAuth::CreatedAt, UserAuth::ModifiedAt])
            .values_panic([
                "00000000-0000-0000-0000-000000000021".into(),
                "$argon2id$v=19$m=19456,t=2,p=1$XBFwBY52C9SpzkxON1OTLg$djDqZQvzxFKc9HOCWyZfKy+RlFTs0BJFSkcw/Tos14c".into(),
                Expr::current_timestamp().into(),
                Expr::current_timestamp().into(),
            ])
            .to_owned();

        db.execute(db.get_database_backend().build(&insert)).await?;

        Ok(())
    }

    async fn down(&self, manager: &SchemaManager) -> Result<(), DbErr> {
        let db = manager.get_connection();

        // Delete all test data
        db.execute(
            db.get_database_backend()
                .build(&Query::delete().from_table(UserAuth::Table).to_owned()),
        )
        .await?;

        db.execute(
            db.get_database_backend()
                .build(&Query::delete().from_table(Devices::Table).to_owned()),
        )
        .await?;

        db.execute(
            db.get_database_backend()
                .build(&Query::delete().from_table(Users::Table).to_owned()),
        )
        .await?;

        Ok(())
    }
}

impl Migration {
    fn get_all_devices_data(
        &self,
    ) -> Vec<(
        &'static str,
        &'static str,
        &'static str,
        &'static str,
        &'static str,
    )> {
        vec![
            // user01
            (
                "00000000-0000-0000-0000-000000000001",
                "00000000-0000-0000-0000-000000000001",
                "device01-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000002",
                "00000000-0000-0000-0000-000000000001",
                "device01-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000003",
                "00000000-0000-0000-0000-000000000001",
                "device01-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000004",
                "00000000-0000-0000-0000-000000000001",
                "device01-4",
                "active",
                "iOS",
            ),
            // user02
            (
                "00000000-0000-0000-0000-000000000005",
                "00000000-0000-0000-0000-000000000002",
                "device02-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000006",
                "00000000-0000-0000-0000-000000000002",
                "device02-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000007",
                "00000000-0000-0000-0000-000000000002",
                "device02-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000008",
                "00000000-0000-0000-0000-000000000002",
                "device02-4",
                "active",
                "Android",
            ),
            // user03
            (
                "00000000-0000-0000-0000-000000000009",
                "00000000-0000-0000-0000-000000000003",
                "device03-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000010",
                "00000000-0000-0000-0000-000000000003",
                "device03-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000011",
                "00000000-0000-0000-0000-000000000003",
                "device03-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000012",
                "00000000-0000-0000-0000-000000000003",
                "device03-4",
                "active",
                "iOS",
            ),
            // user04
            (
                "00000000-0000-0000-0000-000000000013",
                "00000000-0000-0000-0000-000000000004",
                "device04-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000014",
                "00000000-0000-0000-0000-000000000004",
                "device04-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000015",
                "00000000-0000-0000-0000-000000000004",
                "device04-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000016",
                "00000000-0000-0000-0000-000000000004",
                "device04-4",
                "active",
                "Android",
            ),
            // user05
            (
                "00000000-0000-0000-0000-000000000017",
                "00000000-0000-0000-0000-000000000005",
                "device05-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000018",
                "00000000-0000-0000-0000-000000000005",
                "device05-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000019",
                "00000000-0000-0000-0000-000000000005",
                "device05-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000020",
                "00000000-0000-0000-0000-000000000005",
                "device05-4",
                "active",
                "iOS",
            ),
            // user06
            (
                "00000000-0000-0000-0000-000000000021",
                "00000000-0000-0000-0000-000000000006",
                "device06-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000022",
                "00000000-0000-0000-0000-000000000006",
                "device06-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000023",
                "00000000-0000-0000-0000-000000000006",
                "device06-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000024",
                "00000000-0000-0000-0000-000000000006",
                "device06-4",
                "active",
                "Android",
            ),
            // user07
            (
                "00000000-0000-0000-0000-000000000025",
                "00000000-0000-0000-0000-000000000007",
                "device07-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000026",
                "00000000-0000-0000-0000-000000000007",
                "device07-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000027",
                "00000000-0000-0000-0000-000000000007",
                "device07-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000028",
                "00000000-0000-0000-0000-000000000007",
                "device07-4",
                "active",
                "iOS",
            ),
            // user08
            (
                "00000000-0000-0000-0000-000000000029",
                "00000000-0000-0000-0000-000000000008",
                "device08-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000030",
                "00000000-0000-0000-0000-000000000008",
                "device08-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000031",
                "00000000-0000-0000-0000-000000000008",
                "device08-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000032",
                "00000000-0000-0000-0000-000000000008",
                "device08-4",
                "active",
                "Android",
            ),
            // user09
            (
                "00000000-0000-0000-0000-000000000033",
                "00000000-0000-0000-0000-000000000009",
                "device09-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000034",
                "00000000-0000-0000-0000-000000000009",
                "device09-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000035",
                "00000000-0000-0000-0000-000000000009",
                "device09-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000036",
                "00000000-0000-0000-0000-000000000009",
                "device09-4",
                "active",
                "iOS",
            ),
            // user10
            (
                "00000000-0000-0000-0000-000000000037",
                "00000000-0000-0000-0000-000000000010",
                "device10-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000038",
                "00000000-0000-0000-0000-000000000010",
                "device10-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000039",
                "00000000-0000-0000-0000-000000000010",
                "device10-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000040",
                "00000000-0000-0000-0000-000000000010",
                "device10-4",
                "active",
                "Android",
            ),
            // user11
            (
                "00000000-0000-0000-0000-000000000041",
                "00000000-0000-0000-0000-000000000011",
                "device11-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000042",
                "00000000-0000-0000-0000-000000000011",
                "device11-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000043",
                "00000000-0000-0000-0000-000000000011",
                "device11-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000044",
                "00000000-0000-0000-0000-000000000011",
                "device11-4",
                "active",
                "iOS",
            ),
            // user12
            (
                "00000000-0000-0000-0000-000000000045",
                "00000000-0000-0000-0000-000000000012",
                "device12-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000046",
                "00000000-0000-0000-0000-000000000012",
                "device12-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000047",
                "00000000-0000-0000-0000-000000000012",
                "device12-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000048",
                "00000000-0000-0000-0000-000000000012",
                "device12-4",
                "active",
                "Android",
            ),
            // user13
            (
                "00000000-0000-0000-0000-000000000049",
                "00000000-0000-0000-0000-000000000013",
                "device13-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000050",
                "00000000-0000-0000-0000-000000000013",
                "device13-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000051",
                "00000000-0000-0000-0000-000000000013",
                "device13-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000052",
                "00000000-0000-0000-0000-000000000013",
                "device13-4",
                "active",
                "iOS",
            ),
            // user14
            (
                "00000000-0000-0000-0000-000000000053",
                "00000000-0000-0000-0000-000000000014",
                "device14-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000054",
                "00000000-0000-0000-0000-000000000014",
                "device14-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000055",
                "00000000-0000-0000-0000-000000000014",
                "device14-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000056",
                "00000000-0000-0000-0000-000000000014",
                "device14-4",
                "active",
                "Android",
            ),
            // user15
            (
                "00000000-0000-0000-0000-000000000057",
                "00000000-0000-0000-0000-000000000015",
                "device15-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000058",
                "00000000-0000-0000-0000-000000000015",
                "device15-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000059",
                "00000000-0000-0000-0000-000000000015",
                "device15-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000060",
                "00000000-0000-0000-0000-000000000015",
                "device15-4",
                "active",
                "iOS",
            ),
            // user16
            (
                "00000000-0000-0000-0000-000000000061",
                "00000000-0000-0000-0000-000000000016",
                "device16-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000062",
                "00000000-0000-0000-0000-000000000016",
                "device16-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000063",
                "00000000-0000-0000-0000-000000000016",
                "device16-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000064",
                "00000000-0000-0000-0000-000000000016",
                "device16-4",
                "active",
                "Android",
            ),
            // user17
            (
                "00000000-0000-0000-0000-000000000065",
                "00000000-0000-0000-0000-000000000017",
                "device17-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000066",
                "00000000-0000-0000-0000-000000000017",
                "device17-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000067",
                "00000000-0000-0000-0000-000000000017",
                "device17-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000068",
                "00000000-0000-0000-0000-000000000017",
                "device17-4",
                "active",
                "iOS",
            ),
            // user18
            (
                "00000000-0000-0000-0000-000000000069",
                "00000000-0000-0000-0000-000000000018",
                "device18-1",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000070",
                "00000000-0000-0000-0000-000000000018",
                "device18-2",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000071",
                "00000000-0000-0000-0000-000000000018",
                "device18-3",
                "pending",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000072",
                "00000000-0000-0000-0000-000000000018",
                "device18-4",
                "active",
                "Android",
            ),
            // user19
            (
                "00000000-0000-0000-0000-000000000073",
                "00000000-0000-0000-0000-000000000019",
                "device19-1",
                "active",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000074",
                "00000000-0000-0000-0000-000000000019",
                "device19-2",
                "inactive",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000075",
                "00000000-0000-0000-0000-000000000019",
                "device19-3",
                "pending",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000076",
                "00000000-0000-0000-0000-000000000019",
                "device19-4",
                "active",
                "iOS",
            ),
            // user20
            (
                "00000000-0000-0000-0000-000000000077",
                "00000000-0000-0000-0000-000000000020",
                "device20-1",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000078",
                "00000000-0000-0000-0000-000000000020",
                "device20-2",
                "inactive",
                "iOS",
            ),
            (
                "00000000-0000-0000-0000-000000000079",
                "00000000-0000-0000-0000-000000000020",
                "device20-3",
                "active",
                "Android",
            ),
            (
                "00000000-0000-0000-0000-000000000080",
                "00000000-0000-0000-0000-000000000020",
                "device20-4",
                "decommissioned",
                "iOS",
            ),
        ]
    }
}
